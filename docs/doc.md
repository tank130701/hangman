
# Документация по серверу Hangman

## Общая информация
Серверная часть написана на языке Go и работает через TCP. Она предоставляет интерфейс для взаимодействия клиента с серверу через Protobuf-сообщения. Все сообщения обрабатываются через зарегистрированные команды.

### Протокол обмена сообщениями
Каждое сообщение между клиентом и сервером состоит из двух частей:
1. **Заголовок** (4 байта): указывает длину тела сообщения.
2. **Тело сообщения**: сериализованные Protobuf-данные.

### Структура сообщений
1. **ClientMessage**
   - `Command` (string): название команды, которую клиент отправляет серверу.
   - `Payload` ([]byte): полезная нагрузка, содержащая сериализованные данные.

2. **ServerResponse**
   - `StatusCode` (int32): статус выполнения команды (2000 - успех, другие значения - ошибки).
   - `Message` (string): описание ответа сервера.
   - `Payload` ([]byte): полезная нагрузка с данными ответа.

---

## Коды статусов

| Код   | Описание                          |
|-------|-----------------------------------|
| 2000  | Успех                            |
| 4000  | Некорректный формат              |
| 4004  | Неизвестная команда              |
| 4003  | Неавторизованное действие        |
| 4009  | Конфликт (например, комната уже существует) |
| 5000  | Ошибка на сервере                |

---

## Поддерживаемые команды

### 1. CREATE_ROOM
**Описание**: Создает новую игровую комнату.

- **Запрос**:
  ```json
  {
    "player_username": "имя игрока",
    "room_id": "идентификатор комнаты",
    "password": "пароль комнаты",
    "category": "категория игры",
    "difficulty": "сложность"
  }
  ```
- **Ответ**:
  ```json
  {
    "message": "Room has been created successfully",
    "room_id": "идентификатор комнаты"
  }
  ```

---

### 2. JOIN_ROOM
**Описание**: Подключение к существующей комнате.

- **Запрос**:
  ```json
  {
    "player_username": "имя игрока",
    "room_id": "идентификатор комнаты",
    "password": "пароль комнаты"
  }
  ```
- **Ответ**:
  ```json
  {
    "id": "идентификатор комнаты",
    "owner": "владелец комнаты",
    "players": [
      {
        "username": "имя игрока",
        "score": 0,
        "is_connected": true
      }
    ],
    "last_activity": "время последней активности",
    "max_players": 5,
    "password": "пароль комнаты",
    "category": "категория",
    "difficulty": "сложность",
    "state": "текущий статус комнаты"
  }
  ```

---

### 3. START_GAME
**Описание**: Запускает игру в указанной комнате.

- **Запрос**:
  ```json
  {
    "player_username": "имя владельца комнаты",
    "room_id": "идентификатор комнаты",
    "password": "пароль комнаты"
  }
  ```
- **Ответ**:
  ```json
  {
    "message": "Game started successfully"
  }
  ```

---

### 4. LEAVE_ROOM
**Описание**: Отключение игрока от комнаты.

- **Запрос**:
  ```json
  {
    "player_username": "имя игрока",
    "room_id": "идентификатор комнаты",
    "password": "пароль комнаты"
  }
  ```
- **Ответ**:
  ```json
  {
    "message": "Successfully left the room",
    "room_id": "идентификатор комнаты"
  }
  ```

---

### 5. DELETE_ROOM
**Описание**: Удаляет комнату. Доступно только владельцу.

- **Запрос**:
  ```json
  {
    "player_username": "имя владельца",
    "room_id": "идентификатор комнаты",
    "password": "пароль комнаты"
  }
  ```
- **Ответ**:
  ```json
  {
    "message": "Room deleted successfully"
  }
  ```

---

### 6. GUESS_LETTER
**Описание**: Отправляет предположение буквы для текущей игры.

- **Запрос**:
  ```json
  {
    "player_username": "имя игрока",
    "password": "пароль комнаты",
    "room_id": "идентификатор комнаты",
    "letter": "буква"
  }
  ```
- **Ответ**:
  ```json
  {
    "player_username": "имя игрока",
    "is_correct": true,
    "game_over": false,
    "feedback": "результат предположения"
  }
  ```

---

### 7. GET_GAME_STATE
**Описание**: Возвращает текущее состояние игры.

- **Запрос**:
  ```json
  {
    "player_username": "имя игрока",
    "room_id": "идентификатор комнаты"
  }
  ```
- **Ответ**:
  ```json
  {
    "players": {
      "имя игрока": {
        "word_progress": "_ _ a _ _",
        "attempts_left": 5,
        "is_game_over": false,
        "score": 10
      }
    }
  }
  ```

---

### 8. GET_ALL_ROOMS
**Описание**: Получает список всех комнат.

- **Запрос**:
  ```json
  {}
  ```
- **Ответ**:
  ```json
  {
    "rooms": [
      {
        "id": "идентификатор комнаты",
        "owner": "владелец комнаты",
        "players_count": 3,
        "max_players": 5,
        "last_activity": "время последней активности",
        "game_state": "текущий статус игры"
      }
    ]
  }
  ```

---

### 9. GET_LEADERBOARD
**Описание**: Получает информацию о рейтинге игроков.

- **Запрос**:
  ```json
  {}
  ```
- **Ответ**:
  ```json
  {
    "players": [
      {
        "username": "имя игрока",
        "score": 100
      }
    ]
  }
  ```

---

### Пример использования
Клиент отправляет команду `CREATE_ROOM`:
1. Формирует сообщение Protobuf:
   ```json
   {
     "command": "CREATE_ROOM",
     "payload": {
       "player_username": "Alice",
       "room_id": "room123",
       "password": "secure123",
       "category": "animals",
       "difficulty": "easy"
     }
   }
   ```
2. Сервер возвращает ответ:
   ```json
   {
     "status_code": 2000,
     "message": "Room has been created successfully",
     "payload": {
       "room_id": "room123"
     }
   }
   ```
